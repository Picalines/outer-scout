@page "/"

@using Microsoft.AspNetCore.SignalR.Client;
@using Picalines.OuterWilds.SceneRecorder.WebUI.Hubs;

@inject NavigationManager NavigationManager

<h1>Hello, world!</h1>

<p>Time since startup: @_TimeSinceStartup</p>
<button @onclick=OnUpdateClicked>update</button>

@code {
    private HubConnection? _HubConnection = null;

    private float _TimeSinceStartup = 0;

    protected override async Task OnInitializedAsync()
    {
        _HubConnection = new HubConnectionBuilder()
            .WithUrl(NavigationManager.ToAbsoluteUri("/signalr"))
            .Build();

        _HubConnection.On(nameof(StateHub.ReceiveTimeSinceStartup), async (float time) =>
        {
            _TimeSinceStartup = time;
            await InvokeAsync(StateHasChanged);
        });

        await _HubConnection.StartAsync();
    }

    private async void OnUpdateClicked()
    {
        await _HubConnection!.SendAsync(nameof(StateHub.GetTimeSinceStartup));
    }
}
